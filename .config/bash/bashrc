#!/usr/bin/env bash
# ModMe GenUI Workbench - Project bash profile
# Location: .config/bash/bashrc
# This file is intended to be sourced by the user's ~/.bashrc via
# the repository setup script (`scripts/setup-shell-integration.sh`).

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" >/dev/null 2>&1 && pwd)"
PROJECT_ROOT="$(realpath "$SCRIPT_DIR/../..")"

function show_project_commands() {
    echo "ModMe GenUI Workbench - Project Commands"
    echo "  dev       - Start both frontend and agent servers"
    echo "  ui        - Start Next.js frontend only"
    echo "  agent     - Start Python agent only"
    echo "  mcp       - Start MCP servers"
    echo "  validate  - Validate toolsets configuration"
    echo "  docs      - Generate all documentation"
    echo "  venv      - Activate Python virtual environment"
    echo "  help      - Show this message"
}

dev() {
    (cd "$PROJECT_ROOT" && npm run dev)
}

ui() {
    (cd "$PROJECT_ROOT" && npm run dev:ui)
}

agent() {
    (cd "$PROJECT_ROOT" && npm run dev:agent)
}

mcp() {
    (cd "$PROJECT_ROOT" && bash "$PROJECT_ROOT/scripts/start-mcp-servers.sh" 2>/dev/null || bash "$PROJECT_ROOT/scripts/start-mcp-servers.ps1" 2>/dev/null)
}

validate() {
    (cd "$PROJECT_ROOT" && npm run validate:toolsets 2>/dev/null || node "$PROJECT_ROOT/scripts/toolset-management/validate-toolsets.js" 2>/dev/null || echo "Validation script not found")
}

docs() {
    (cd "$PROJECT_ROOT" && npm run docs:all)
}

venv() {
    if [[ -f "$PROJECT_ROOT/agent/.venv/bin/activate" ]]; then
        source "$PROJECT_ROOT/agent/.venv/bin/activate"
    elif [[ -f "$PROJECT_ROOT/agent/.venv/Scripts/Activate.ps1" ]]; then
        echo "Windows venv activation script detected; use PowerShell 'venv' function to activate.";
    else
        echo "Virtual environment not found at $PROJECT_ROOT/agent/.venv"
    fi
}

alias help='show_project_commands'

# Display a short welcome when running inside VS Code terminal
if [[ "$TERM_PROGRAM" == "vscode" ]]; then
    echo -e "\e[32mâœ“ VS Code shell integration enabled for ModMe GenUI Workbench\e[0m"
fi
# VS Code Shell Integration for Bash (Git Bash)
# This file is automatically loaded when Bash starts in VS Code
# Documentation: https://code.visualstudio.com/docs/terminal/shell-integration

# Enable shell integration if running in VS Code
if [[ "$TERM_PROGRAM" == "vscode" ]]; then
    SHELL_INTEGRATION_PATH="$(code --locate-shell-integration-path bash 2>/dev/null)"
    if [[ -f "$SHELL_INTEGRATION_PATH" ]]; then
        . "$SHELL_INTEGRATION_PATH"
        echo "âœ“ VS Code shell integration enabled"
    fi
fi

# Navigate to project root
cd "$(dirname "${BASH_SOURCE[0]}")/../.." || exit

# Project-specific aliases
alias dev='npm run dev'
alias agent='npm run dev:agent'
alias ui='npm run dev:ui'
alias mcp='pwsh -File scripts/start-mcp-servers.ps1'
alias validate='node scripts/toolset-management/validate-toolsets.js'
alias docs='npm run docs:all'
alias venv='source agent/.venv/Scripts/activate'

# Show available project commands
function help() {
    echo ""
    echo "ðŸ“‹ ModMe GenUI Workbench - Available Commands:"
    echo "  dev       - Start both frontend and agent servers"
    echo "  ui        - Start Next.js frontend only"
    echo "  agent     - Start Python agent only"
    echo "  mcp       - Start MCP servers"
    echo "  validate  - Validate toolsets configuration"
    echo "  docs      - Generate all documentation"
    echo "  venv      - Activate Python virtual environment"
    echo "  help      - Show this message"
    echo ""
}

# Welcome message
echo "ðŸŽ¨ ModMe GenUI Workbench"
echo "Type 'help' for available commands"
echo ""
